---
name: code-quality-gate
description: 质量关，输出测试计划、必测文件、性能考虑、迁移回滚与风险等级，并生成给 Codex 的修正清单。用户提到测试、边界、性能、回滚、质量门槛时使用。
---

# Quality Gate（质量关）

用于在改动前后给出可执行的质量门槛，强制把问题转为修正清单交给 Codex 逐项修复。

详细说明与示例见 `README.md`。

## 使用说明

1. 先读取改动范围与相关模块。
2. 仅输出固定结构，不直接改代码。
3. 所有问题必须转成可执行的修正清单，可独立验证。

## 固定输出格式

**Test Plan（哪些测试，覆盖哪些边界）**
- 说明测试类型与覆盖边界（单测/集成/端到端）
- 至少覆盖输入边界、错误路径、权限或并发

**Required tests（必须新增/更新的测试文件清单）**
- 列出必须新增或更新的测试文件路径

**Performance considerations（是否引入 N+1、重渲染、重查询）**
- 说明是否新增 N+1、重复渲染、重查询或过度 IO

**Migration/rollback（是否需要迁移脚本、如何回滚）**
- 说明是否需要迁移与回滚策略（含脚本或开关）

**Risk level（low/medium/high）**
- 给出整体风险等级与一句话理由

**修正清单（Checklist）**
- 每条必须包含：文件路径 + 期望修改 + 可验证方式
- 不允许直接改代码，必须是可执行清单

**指令**
- “按清单逐项修复，直到通过 quality gate。”

## 默认规则

- 只做评估与清单，不做直接修改
- 测试与风险必须可验证
- 性能考虑必须明确结论（无/有，说明原因）
