---
name: code_cr
description: 对代码变更做深度且严格的代码评审。用于提交前或PR前，用户提到代码评审、CR、PR review，或要求评审diff/patch时使用。评审结果按 code_docs-creator 规范输出并默认落盘到目标项目 docs/cr_local。
---

# 深度代码评审

对改动做深度评审，重点关注正确性、安全性、性能与可维护性。

详细说明与示例见 `README.md`。

## 评审流程

1. 未提供时，先索要精确的 diff 或变更文件列表。
2. 只评审变更及其直接上下文，避免无关重构建议。
3. 按严重性排序问题：
   - 正确性缺陷、安全风险、数据丢失、并发问题
   - 行为回归、边界情况、错误处理缺口
   - 性能陷阱、资源泄漏、可扩展性限制
   - 可维护性风险、逻辑不清、缺失测试
4. 每个问题需包含：
   - 文件路径与行号（可用时）
   - 风险原因
   - 修复建议或替代方案
5. 若无问题，明确说明，并指出残余风险或测试缺口。
6. 仅在判断正确性所必需时，询问缺失上下文（需求、期望行为、配置）。
7. 保持结构化、可执行；除非要求，不重写代码。
8. 输出评审结果时，使用 `code_docs-creator` 的文档规范与输出规则。
9. 默认输出到目标项目 `docs/cr_local/`；若用户指定目录，先查看该目录已有文档格式并优先对齐。

## 输出格式

1. 先列出问题，按严重性排序。
2. 开放问题或假设。
3. 简要变更概述（可选）。
4. 建议的下一步（测试、检查项）。
